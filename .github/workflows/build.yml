  Build and Release daily_plan Desktop

  on:
    push:
      tags:
        - 'v*'

  jobs:
    build-and-release:
      runs-on: ${{ matrix.os }}
      strategy:
        matrix:
          os: [windows-latest, macos-latest, ubuntu-latest]
          target: [windows, macos, linux]

      steps:
        - name: Checkout code
          uses: actions/checkout@v2

        - name: Set up Flutter
          uses: subosito/flutter-action@v2
          with:
            flutter-version: 'stable'

        - name: Get Flutter dependencies
          run: flutter pub get

        - name: Build daily_plan release
          run: flutter build ${{ matrix.target }} --release

        - name: Create Release
          id: create_release
          uses: actions/create-release@v1
          env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          with:
            tag_name: ${{ github.ref }}
            release_name: daily_plan Release ${{ github.ref }}
            draft: false
            prerelease: false

        - name: Upload release asset
          uses: actions/upload-release-asset@v1
          env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          with:
            upload_url: ${{ steps.create_release.outputs.upload_url }}
            asset_path: ./build/${{ matrix.target }}/release/daily_plan${{ matrix.target == 'windows' ? '.exe' : '' }}
            asset_name: daily_plan-${{ matrix.target }}-${{ github.ref_name }}${{ matrix.target == 'windows' ? '.exe' : '' }}
            asset_content_type: application/octet-stream